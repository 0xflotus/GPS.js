/*
GPS.js v0.4.7 26/01/2016

Copyright (c) 2016, Robert Eisele (robert@xarg.org)
Dual licensed under the MIT or GPL Version 2 licenses.
*/
!function(t){"use strict";var e=Math.PI/180,r=(Math.PI,Math.PI,Math.PI,Math.PI,[]);function n(t,e){if(""===t)return null;var r=new Date;if(e){var n=e.slice(4),a=e.slice(2,4)-1,i=e.slice(0,2);4===n.length?r.setUTCFullYear(Number(n),Number(a),Number(i)):r.setUTCFullYear(Number("20"+n),Number(a),Number(i))}r.setUTCHours(Number(t.slice(0,2))),r.setUTCMinutes(Number(t.slice(2,4))),r.setUTCSeconds(Number(t.slice(4,6)));var s=t.slice(7),l=s.length,o=0;return 0!==l&&(o=parseFloat(s)*Math.pow(10,3-l)),r.setUTCMilliseconds(Number(o)),r}function a(t,e){if(""===t)return null;var r,n=1;switch(e){case"S":n=-1;case"N":r=2;break;case"W":n=-1;case"E":r=3}return n*(parseFloat(t.slice(0,r))+parseFloat(t.slice(r))/60)}function i(t){return""===t?null:parseFloat(t)}function s(t){return""===t?null:1.852*parseFloat(t)}function l(t){switch(t){case"A":return"active";case"V":return"void";case"":return null}throw new Error("INVALID RMC/GLL STATUS: "+t)}function o(t){switch(t){case"A":return"autonomous";case"D":return"differential";case"E":return"estimated";case"M":return"manual input";case"S":return"simulated";case"N":return"not valid";case"P":return"precise"}throw new Error("INVALID FAA MODE: "+t)}function u(t,e){if("M"===e||""===e)return i(t);throw new Error("Unknown unit: "+e)}function c(){if(!(this instanceof c))return new c;this.events={},this.state={}}c.prototype.events=null,c.prototype.state=null,c.mod={GGA:function(t,e){if(16!==e.length)throw new Error("Invalid GGA length: "+t);return{time:n(e[1]),lat:a(e[2],e[3]),lon:a(e[4],e[5]),alt:u(e[9],e[10]),quality:function(t){switch(parseInt(t,10)||t){case"":case 0:return null;case 1:return"fix";case 2:return"dgps-fix";case 3:return"pps-fix";case 4:return"rtk";case 5:return"rtk-float";case 6:return"estimated";case 7:return"manual";case 8:return"simulated"}throw new Error("INVALID GGA FIX: "+t)}(e[6]),satellites:i(e[7]),hdop:i(e[8]),geoidal:u(e[11],e[12]),age:i(e[13]),stationID:i(e[14])}},GSA:function(t,e){if(19!==e.length)throw new Error("Invalid GSA length: "+t);for(var r=[],n=3;n<15;n++)""!==e[n]&&r.push(parseInt(e[n],10));return{mode:function(t){switch(t){case"M":return"manual";case"A":return"automatic";case"":return null}throw new Error("INVALID GSA MODE: "+t)}(e[1]),fix:function(t){switch(t){case"1":case"":return null;case"2":return"2D";case"3":return"3D"}throw new Error("INVALID GSA FIX: "+t)}(e[2]),satellites:r,pdop:i(e[15]),hdop:i(e[16]),vdop:i(e[17])}},RMC:function(t,e){if(13!==e.length&&14!==e.length)throw new Error("Invalid RMC length: "+t);return{time:n(e[1],e[9]),status:l(e[2]),lat:a(e[3],e[4]),lon:a(e[5],e[6]),speed:s(e[7]),track:i(e[8]),variation:function(t,e){if(""===t||""===e)return null;var r="W"===e?-1:1;return parseFloat(t)*r}(e[10],e[11]),faa:14===e.length?o(e[12]):null}},VTG:function(t,e){if(10!==e.length&&11!==e.length)throw new Error("Invalid VTG length: "+t);if(""===e[2]&&""===e[8]&&""===e[6])return{track:null,trackMagetic:null,speed:null,faa:null};if("T"!==e[2])throw new Error("Invalid VTG track mode: "+t);if("K"!==e[8]||"N"!==e[6])throw new Error("Invalid VTG speed tag: "+t);return{track:i(e[1]),trackMagnetic:""===e[3]?null:i(e[3]),speed:s(e[5]),faa:11===e.length?o(e[9]):null}},GSV:function(t,e){if(e.length<9||e.length%4!=1)throw new Error("Invalid GSV length: "+t);for(var r=[],n=4;n<e.length-1;n+=4){var a=i(e[n]),s=i(e[n+3]);r.push({prn:a,elevation:i(e[n+1]),azimuth:i(e[n+2]),snr:s,status:null!==a?null!==s?"tracking":"in view":null})}return{msgNumber:i(e[2]),msgsTotal:i(e[1]),satellites:r}},GLL:function(t,e){if(9!==e.length)throw new Error("Invalid GLL length: "+t);return{time:n(e[5]),status:l(e[6]),lat:a(e[1],e[2]),lon:a(e[3],e[4])}},ZDA:function(t,e){return{time:n(e[1],e[2]+e[3]+e[4])}},GST:function(t,e){if(10!==e.length)throw new Error("Invalid GST length: "+t);return{time:n(e[1]),rms:i(e[2]),ellipseMajor:i(e[3]),ellipseMinor:i(e[4]),ellipseOrientation:i(e[5]),latitudeError:i(e[6]),longitudeError:i(e[7]),heightError:i(e[8])}},HDT:function(t,e){if(4!==e.length)throw new Error("Invalid HDT length: "+t);return{heading:parseFloat(e[1]),trueNorth:"T"===e[2]}}},c.Parse=function(t){if("string"!=typeof t)return!1;var e=t.split(","),r=e.pop();if(e.length<2||"$"!==t.charAt(0)||-1===r.indexOf("*"))return!1;if(r=r.split("*"),e.push(r[0]),e.push(r[1]),e[0]=e[0].slice(3),void 0!==c.mod[e[0]]){var n=this.mod[e[0]](t,e);return n.raw=t,n.valid=function(t,e){for(var r=0,n=1;n<t.length;n++){var a=t.charCodeAt(n);if(42===a)break;r^=a}return r===parseInt(e,16)}(t,e[e.length-1]),n.type=e[0],n}return!1},c.Heading=function(t,r,n,a){var i=(a-r)*e;t*=e,n*=e;var s=Math.sin(i),l=Math.cos(i),o=Math.sin(t),u=Math.cos(t),c=Math.sin(n),h=Math.cos(n),p=s*h,f=u*c-o*h*l;return(180*Math.atan2(p,f)/Math.PI+360)%360},c.Distance=function(t,r,n,a){var i=(n-t)*e*.5,s=(a-r)*e*.5;t*=e,n*=e;var l=Math.sin(i),o=Math.sin(s),u=l*l+Math.cos(t)*Math.cos(n)*o*o;return 12745.6*Math.asin(Math.sqrt(u))},c.TotalDistance=function(t){if(t.length<2)return 0;for(var e=0,r=0;r<t.length-1;r++){var n=t[r],a=t[r+1];e+=c.Distance(n.lat,n.lon,a.lat,a.lon)}return e},c.prototype.update=function(t){var e=c.Parse(t);return!1!==e&&(function(t,e){if("RMC"!==e.type&&"GGA"!==e.type&&"GLL"!==e.type||(t.time=e.time,t.lat=e.lat,t.lon=e.lon),"ZDA"===e.type&&(t.time=e.time),"GGA"===e.type&&(t.alt=e.alt),"RMC"===e.type&&(t.speed=e.speed,t.track=e.track),"GSA"===e.type&&(t.satsActive=e.satellites,t.fix=e.fix,t.hdop=e.hdop,t.pdop=e.pdop,t.vdop=e.vdop),"GSV"===e.type){for(var n=e.satellites,a=0;a<n.length;a++)r.push(n[a]);e.msgNumber===e.msgsTotal&&(t.satsVisible=r,r=[])}}(this.state,e),this.emit("data",e),this.emit(e.type,e),!0)},c.prototype.partial="",c.prototype.updatePartial=function(t){for(this.partial+=t;;){var e=this.partial.indexOf("\r\n");if(-1===e)break;var r=this.partial.slice(0,e);"$"===r.charAt(0)&&this.update(r),this.partial=this.partial.slice(e+2)}},c.prototype.on=function(t,e){return void 0===this.events[t]?(this.events[t]=e,this):null},c.prototype.off=function(t){return void 0!==this.events[t]&&(this.events[t]=void 0),this},c.prototype.emit=function(t,e){void 0!==this.events[t]&&this.events[t].call(this,e)},"object"==typeof exports?(Object.defineProperty(exports,"__esModule",{value:!0}),c.default=c,c.GPS=c,module.exports=c):t.GPS=c}(this);
